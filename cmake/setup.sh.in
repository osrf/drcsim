# This file is the entry point for drcsim users.  It should establish all environment necessary to use the drcsim.

# Step 1: get ROS configuration.  Special case for different shells, to pull in command-line completion.
if [ $SHELL = /bin/bash ]; then
  . /opt/ros/@ROS_DISTRO@/setup.bash
elif [ $SHELL = /bin/zsh ]; then
  . /opt/ros/@ROS_DISTRO@/setup.zsh
else
  . /opt/ros/@ROS_DISTRO@/setup.sh 
fi

# Step 2: modify ROS configuration.
# Add each of our installed model directories to ROS_PACKAGE_PATH, so that ROS tools can locate resources stored within them.  
# We don't just add the top 'models' directory because it contains a 'manifest.xml', which stops rospack in its tracks.
for d in `find @CMAKE_INSTALL_PREFIX@/share/@PROJECT_NAME@-@DRC_SIM_VERSION@/models -mindepth 1 -maxdepth 1 -type d`; do export ROS_PACKAGE_PATH=$d:$ROS_PACKAGE_PATH; done
# Also add our 'ros' directory to RPP; it contains utility packages with things like launch files
export ROS_PACKAGE_PATH=@CMAKE_INSTALL_PREFIX@/share/@PROJECT_NAME@-@DRC_SIM_VERSION@/ros:$ROS_PACKAGE_PATH
# Make ROS plugins visible to the runtime loader; they'll be pulled in by ROS via pluginlib
export LD_LIBRARY_PATH=@CMAKE_INSTALL_PREFIX@/@LIB_INSTALL_DIR@/@PROJECT_NAME@-@DRC_SIM_VERSION@/plugins:$LD_LIBRARY_PATH

# Step 3: get Gazebo configuration.
if [ -f @CMAKE_INSTALL_PREFIX@/share/gazebo-@GAZEBO_VERSION@/setup.sh ]; then
  . @CMAKE_INSTALL_PREFIX@/share/gazebo-@GAZEBO_VERSION@/setup.sh 
elif [ -f /usr/share/gazebo-@GAZEBO_VERSION@/setup.sh ]; then
  . /usr/share/gazebo-@GAZEBO_VERSION@/setup.sh  
else
  echo "Warning: failed to find Gazebo's setup.sh.  You will need to source it manually."
fi

# Step 4: modify Gazebo configuration.
export GAZEBO_RESOURCE_PATH=@CMAKE_INSTALL_PREFIX@/share/@PROJECT_NAME@-@DRC_SIM_VERSION@/worlds:$GAZEBO_RESOURCE_PATH
export GAZEBO_MODEL_PATH=@CMAKE_INSTALL_PREFIX@/share/@PROJECT_NAME@-@DRC_SIM_VERSION@/models:$GAZEBO_MODEL_PATH
export GAZEBO_PLUGIN_PATH=@CMAKE_INSTALL_PREFIX@/@LIB_INSTALL_DIR@/@PROJECT_NAME@-@DRC_SIM_VERSION@/plugins:$GAZEBO_PLUGIN_PATH
echo "Warning: unsetting GAZEBO_MODEL_DATABASE_URI to avoid unnecessary network access on startup."
echo "If you want to be able to download models from the online database, then you should:"
echo "  export GAZEBO_MODEL_DATABASE_URI=http://gazebosim.org/models"
echo "prior to starting the simulator."
unset GAZEBO_MODEL_DATABASE_URI
